<div class="right_col" role="main">
  <div class="">
           <!--  <div class="page-title">
              <div class="title_left">
                <h3>Form Elements</h3>
              </div>

              <div class="title_right">
                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search for...">
                    <span class="input-group-btn">
                      <button class="btn btn-default" type="button">Go!</button>
                    </span>
                  </div>
                </div>
              </div>
            </div> -->
<style>
  .btn-circle {
  background-color: white;
  height: 60px;
  width: 90px;
  border-radius: 50%;
}
</style>
            <div class="clearfix"></div>
            <div class="row">
              <div class="col-md-12  col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <div class="col-md-12 col-xs-12">
                      <!-- <input type="submit"  value="Agregar" class="btn btn-dark" onclick="agregar()"  id="ven"> -->

                      <!-- <input type="submit"  value="Agregar" class="btn btn-dark" onclick="agregar()"  id="ven"> -->
                      <button type="submit" value="Agregar" class="btn btn-primary pull-right" onclick="agregar()"><i class="fa fa-plus-square-o fa-lg" id="ven"></i> Agregar</button>

                      <button type="button" class="btn btn-default pull-right" onclick="nada();"><i class="fa fa-search fa-lg"></i> </button>

                      <button type="button" class="btn btn-dark pull-right" data-toggle="modal" data-target=".bs-example-modal-lg"><i class="fa fa-shopping-cart fa-lg"></i> </button>
                      <button type="button" class="btn btn-danger pull-right "  onclick="borrar();"><i class="fa fa-trash fa-lg"></i></button>
                    </div>
                    <div class="clearfix"></div>
                  </div>

                  <div class="x_content">
                    <br />
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="col-xs-12">
                          <label class="control-label"  for="order_id">Codigo del producto</label>
                        <div class="input-group">
                          
                          <input id="scanner_input" class="form-control" placeholder="Click en el boton para escanear" type="text" onchange='buscar_articulo();' /> 
                          <span class="input-group-btn"> 
                            <button class="btn btn-default" type="button" data-toggle="modal" data-target="#livestream_scanner">
                              <i class="fa fa-barcode fa-lg"></i>
                            </button> 
                          </span>
                        </div>
                        </div>

                       <!--  <div class="col-md-12 col-xs-12" >
                          <label class="control-label" for="order_id">Codigo del Producto</label>
                          <input type="text" id="codigo"  value="" placeholder="Codigo del producto" class="form-control" onchange='buscar_articulo();' autocomplete="off">

                          <br></div> -->

                       <!--  <label class="control-label" for="order_id">Codigo del Producto</label>
                        <input type="text" id="codigo"  value="" placeholder="Codigo del producto" class="form-control" onchange='buscar_articulo();' autocomplete="off">
                        <br> -->
                        <div class="col-md-12 col-xs-12" >
                          <label class="control-label"  for="order_id">Nombre del producto</label>
                          <input type="text" id="skills" class="form-control nombre" placeholder="Nombre del Producto" onchange='buscar_articulo_des();'>
           <!--                     <div class="w3-container w3-white w3-margin w3-padding-large">
        
          <h2 style="text-align: center";>Autocomplete textbox using jQuery, PHP and MySQL by Lisenme</h2>
          <br>
          <div class="ui-widget" style="text-align: center";>
             <label for="skills">Skills: </label>
           <input id="skills" class="form-control nombre">
          </div>
            
        </div> -->
        <br></div>
        <center>
                                  <!-- <label class="control-label" for="status">Imagen del producto</label> -->
                                  <br>
                                  <img src="../Content/Imagenes/nohay.jpg" style="max-width: 120px;min-width: 120px; max-height: 110px;min-height: 110px; " id="imagen">

                                  
                                </center>
        

<br>
        <div class="col-md-4 col-xs-4" >
          <label class="control-label" for="status">Precio</label>
          <input style="border-radius: 40px " type="text" id="precio" value="" placeholder="Precio" class="form-control btn-circle"  readonly="">
          <br></div>
          <div class="col-md-4 col-xs-4">
            <label class="control-label" for="status">Oferta</label>
            <input style="border-radius: 40px " type="number" id="precioOferta" value="" placeholder="Oferta" class="form-control btn-circle " required="required" readonly="">
            <br></div>
                        <!-- <div class="col-md-3 col-xs-5">
                        <label class="control-label" for="order_id">Gramaje</label>
                        <input style="border-radius: 40px" type="text" id="gramaje" value="" placeholder="Cantidad" class="form-control btn-circle" required="required">
                        
                        <br></div> -->
                        <div class="col-md-4 col-xs-4"><label class="control-label" for="order_id">Cantidad</label>
                          <!-- <input style="border-radius: 40px" type="number" id="cantidad" value="" placeholder="Cant." class="form-control btn-circle" onchange='total();' required="required"> -->
                          <select  style="border-radius: 40px" name="" id="cantidad" placeholder="Cant." class="form-control btn-circle" onchange='total();' required="required">
                            
    <option value="1" selected>1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">50</option>
    <option value="51">51</option>
    <option value="52">52</option>
    <option value="53">53</option>
    <option value="54">54</option>
    <option value="55">55</option>
    <option value="56">56</option>
    <option value="57">57</option>
    <option value="58">58</option>
    <option value="59">59</option>
    <option value="60">60</option>
    <option value="61">61</option>
    <option value="62">62</option>
    <option value="63">63</option>
    <option value="64">64</option>
    <option value="65">65</option>
    <option value="66">66</option>
    <option value="67">67</option>
    <option value="68">68</option>
    <option value="69">69</option>
    <option value="70">70</option>
    <option value="71">71</option>
    <option value="72">72</option>
    <option value="73">73</option>
    <option value="74">74</option>
    <option value="75">75</option>
    <option value="76">76</option>
    <option value="77">77</option>
    <option value="78">78</option>
    <option value="79">79</option>
    <option value="80">80</option>
    <option value="81">81</option>
    <option value="82">82</option>
    <option value="83">83</option>
    <option value="84">84</option>
    <option value="85">85</option>
    <option value="86">86</option>
    <option value="87">87</option>
    <option value="88">88</option>
    <option value="89">89</option>
    <option value="90">90</option>
    <option value="91">91</option>
    <option value="92">92</option>
    <option value="93">93</option>
    <option value="94">94</option>
    <option value="95">95</option>
    <option value="96">96</option>
    <option value="97">97</option>
    <option value="98">98</option>
    <option value="99">99</option>
    <option value="100">100</option>
                          </select>

                          <br></div>
                          <div class="col-md-4 col-xs-4">
                            <label class="control-label" for="order_id">Precio Final</label>
                            <input style="border-radius: 40px" type="number" id="totalPro" value="" placeholder="Precio" class="form-control btn-circle" readonly="" required="required">

                            <br></div>
                            <div class="col-md-4 col-xs-4">
                              <label class="control-label" for="order_id">Subtotal</label>
                              <input style="border-radius: 40px" type="number" id="subTotal" value="" placeholder="Sub." class="form-control btn-circle" readonly="" required="required">
                              <br></div>
                              <div class="col-md-4 col-xs-4">
                                <label class="control-label" for="order_id">Articulos</label>
                                <input style="border-radius: 40px" type="number" id="totalArticulos" value="" placeholder="Art." class="form-control btn-circle" readonly="" required="required">
                                <br></div>
                                

                              </div>
                            </div>
                   <!-- <div class="col-md-6">
                      <div class="form-group">
                        
                        
                         <input type="submit"  value="Agregar" class="btn btn-dark" onclick="agregar()"  id="ven"> 
                      </div>
                    </div>     -->   


                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



    <script>

      function buscar_articulo(){
        $(document).ready(function(){
     //$(document).ready(function(){
      var cod=$("#scanner_input").val();

      
      $.ajax({
        url: "../Controlador/busca_producto.php",
           // dataType: 'json',
           type: "POST",
           dataType: 'json',
           data: {codigo:cod},
           success: function(data){
             //if (true) {alert("producto no encotrado")}
             $("#skills").val(data.nombre);
             $("#precio").val(data.precio);
             $("#cantidad").val(1);

             alertify.success('Producto encotrado');
             if (data.oferta!=null) {
              $("#precioOferta").val(data.oferta);
            }else{
              $("#precioOferta").val(data.precio);
            }
              //$("#precioOferta").val(data.oferta);
              
              $("#gramaje").val(data.gramaje);
              //$("#subTotal").val(cant*data.precio);
              if (data.codigo!="") {
                $("#imagen").attr('src','../Content/Imagenes/'+data.codigo+'.jpg');
              }
              else{
                $("#imagen").attr('src','../Content/Imagenes/nohay.jpg');
              }

              total();

            }

         //total();

       }).fail( function( jqXHR, textStatus, errorThrown ) {
        borrar();
        //$("#scanner_input").val("");
        alertify.error('No se ha encotrado el producto');
      });
       $("#cantidad").val("");
       $("#totalPro").val("");
       $("#subTotal").val("");
       $("#totalArticulos").val("");
     });
         // })
       }


       function buscar_articulo_des(){
        $(document).ready(function(){
     //$(document).ready(function(){
      var des=$("#skills").val();

      
      $.ajax({
        url: "../Controlador/busca_producto_des.php",
           // dataType: 'json',
           type: "POST",
           dataType: 'json',
           data: {nombre:des},
           success: function(data){
             //if (true) {alert("producto no encotrado")}
             $("#codigo").val(data.codigo);
             $("#precio").val(data.precio);
             $("#cantidad").val(1);

             alertify.success('Producto encotrado');
             if (data.oferta!=null) {
              $("#precioOferta").val(data.oferta);
            }else{
              $("#precioOferta").val(data.precio);
            }
              //$("#precioOferta").val(data.oferta);
              
              $("#gramaje").val(data.gramaje);
              //$("#subTotal").val(cant*data.precio);
              if (data.codigo!="") {
                $("#imagen").attr('src','../Content/Imagenes/'+data.codigo+'.jpg');
              }
              else{
                $("#imagen").attr('src','../Content/Imagenes/nohay.jpg');
              }

              total();

            }
         //total();

       }).fail( function( jqXHR, textStatus, errorThrown ) {
        //borrar();
        //$("#scanner_input").val("");
        alertify.error('No se ha encotrado el producto');
         });
      $("#cantidad").val("");
      $("#totalPro").val("");
      $("#subTotal").val("");
      $("#totalArticulos").val("");
    });
         // })
       }


       function total(){

        var cant = $("#cantidad").val();
            //var precio =$("#precio").val();
            var oferta =$("#precioOferta").val();



            $("#subTotal").val(cant*oferta);
            $("#totalPro").val(oferta);

            $("#totalArticulos").val(cant);

          }
        </script>
        <script>
          function agregar(){
           $(document).ready(function(){

             var monto=0;
             var produc=$("#skills").val();
             var precio=$("#precio").val();
             var precioOfer=$("#precioOferta").val();
             var prec = parseFloat(precio);
             var ofer= parseFloat(precioOfer);
             var cantidad=$("#cantidad").val();
             if (produc=="" || precio=="" ) {
              alertify.alert('Alerta', 'No se ha relizado ninguna busqueda');
            }else{

              if (cantidad=="") {
                cantidad=1;
              }
              if (precioOfer==null || precioOfer==0) {
                 monto= cantidad*precio;
              }
              else if(ofer<prec){
                 monto=cantidad*ofer
              }
              else{
                monto=cantidad*prec;
              }
              
              
              $("#productos > tbody").append("<tr><td class='center'>"+produc+"</td><td class='cant'>"+cantidad+"</td><td class='total'>"+monto+"</td><td class='center'><button class='btn btn-block btn-danger  eliminar' onclick='eliminar();'><i class='fa fa-trash'></i> </button></td></tr>");
              $("#skills").val("");
              $("#cantidad").val("");
              $("#precio").val("");

              var data = [];
              var data2=[];

              $("td.total").each(function(){
               data.push(parseFloat($(this).text()));
             });
              var suma = data.reduce(function(a,b){ return a+b; },0);
              $("#suma").html(suma);
              $("td.cant").each(function(){
               data2.push(parseInt($(this).text()));
             });
              var suma2 = data2.reduce(function(a,b){ return a+b; },0);
              $("#can").html(suma2);
              alertify.success('producto agregado al carrito');
            }
          });

           

           borrar();
         }
         function eliminar(){

          $(document).on('click', '.eliminar', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
            var data = [];
            var data2=[];
            $("td.total").each(function(){
             data.push(parseFloat($(this).text()));
           });
            var suma = data.reduce(function(a,b){ return a+b; },0);
            $("#suma").html(suma);
            if (suma==0) {
              $("#terminar").attr("disabled",true);
            }
            $("td.cant").each(function(){
              data2.push(parseInt($(this).text()));
            });
            var suma2 = data2.reduce(function(a,b){ return a+b; },0);
            $("#can").html(suma2);
          });

        }


        function borrar(){
 $("#scanner_input").val("");
          $("#codigo").val("");
          $("#skills").val("");

          $("#precio").val("");
          $("#precioOferta").val("");


          $("#cantidad").val("");
          $("#totalPro").val("");
          $("#subTotal").val("");
          $("#totalArticulos").val("");
          $("#imagen").attr('src','../Content/Imagenes/nohay.jpg');
        }

        function nada(){
          var cod=$("#scanner_input").val();
          var nom=$("#skills").val();

          if ((cod=="" && nom=="")) {
            alertify.alert('Alerta', 'Favor de llenar el campo codigo del producto o nombre del producto');
          }


        }
      </script>
